<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Human Trafficking in Kenya Information Entry Portal</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <h2>Kenya Portal</h2>
            </div>
            <nav>
                <ul>
                    <li><a href="#data-entry" class="active">Data Entry</a></li>
                    <li><a href="#analytics">Analytics</a></li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main>
            <h1>Human Trafficking in Kenya Information Entry Portal</h1>

            <!-- Agenda Section -->
            <section id="agenda-section">
                <h2>Our Agenda</h2>
                <p>
                    This website is designed to provide a structured entry system for capturing critical data on human trafficking in Kenya. Previously, the absence of a well-organized system led to data being inconsistent, scattered, and underutilized. Our platform aims to:
                </p>
                <ul>
                    <li><strong>Streamline Data Collection:</strong> Allow users to input comprehensive and well-structured information for effective analysis.</li>
                    <li><strong>Ensure Data Usability:</strong> Convert previously unusable data into actionable insights to combat human trafficking.</li>
                    <li><strong>Support Decision-Making:</strong> Provide reliable data for stakeholders to develop informed strategies against trafficking.</li>
                    <li><strong>Promote Accountability:</strong> Enable transparent data logging to track interventions and outcomes.</li>
                </ul>
                <p>
                    By using this system, users can contribute to a centralized, organized database that empowers stakeholders to combat human trafficking more effectively. Letâ€™s make data work for a safer and more just Kenya.
                </p>
            </section>

            <!-- Data Entry Form -->
            <h2 id="data-entry">Submit Human Trafficking Information</h2>
            <form id="communication-form">
                <!-- Required Fields -->
                <label for="MessageID">Message ID:</label>
                <input type="text" id="MessageID" name="MessageID" required readonly><br><br>

                <label for="SenderDetails">Sender Details:</label>
                <input type="text" id="SenderDetails" name="SenderDetails"><br><br>

                <label for="RecipientDetails">Recipient Details:</label>
                <input type="text" id="RecipientDetails" name="RecipientDetails"><br><br>

                <label for="Date">Date:</label>
                <input type="datetime-local" id="Date" name="Date"><br><br>

                <label for="Medium">Medium:</label>
                <input type="text" id="Medium" name="Medium"><br><br>

                <label for="SourceLocation">Source Location:</label>
                <input type="text" id="SourceLocation" name="SourceLocation"><br><br>

                <label for="DestinationLocation">Destination Location:</label>
                <input type="text" id="DestinationLocation" name="DestinationLocation"><br><br>

                <label for="CommunicationType">Communication Type:</label>
                <input type="text" id="CommunicationType" name="CommunicationType"><br><br>

                <label for="NumberOfAdults">Number of Adults:</label>
                <input type="number" id="NumberOfAdults" name="NumberOfAdults"><br><br>

                <label for="NumberOfChildren">Number of Children:</label>
                <input type="number" id="NumberOfChildren" name="NumberOfChildren"><br><br>

                <label for="EventType">Event Type:</label>
                <input type="text" id="EventType" name="EventType"><br><br>

                <label for="EventNotes">Event Notes:</label>
                <textarea id="EventNotes" name="EventNotes"></textarea><br><br>

                <label for="VictimEntity">Victim Entity:</label>
                <input type="text" id="VictimEntity" name="VictimEntity"><br><br>

                <label for="VictimAction">Victim Action:</label>
                <input type="text" id="VictimAction" name="VictimAction"><br><br>

                <label for="VictimOutcome">Victim Outcome:</label>
                <input type="text" id="VictimOutcome" name="VictimOutcome"><br><br>

                <label for="OtherEntityName">Other Entity Name:</label>
                <input type="text" id="OtherEntityName" name="OtherEntityName"><br><br>

                <label for="OtherEntityAction">Other Entity Action:</label>
                <input type="text" id="OtherEntityAction" name="OtherEntityAction"><br><br>

                <label for="OtherEntityOutcome">Other Entity Outcome:</label>
                <input type="text" id="OtherEntityOutcome" name="OtherEntityOutcome"><br><br>

                <label for="SpecificLocation">Specific Location:</label>
                <input type="text" id="SpecificLocation" name="SpecificLocation"><br><br>

                <label for="LocationContext">Location Context:</label>
                <textarea id="LocationContext" name="LocationContext"></textarea><br><br>

                <button type="submit">Submit</button>
            </form>

    <!-- Analytics Section -->
            <h2 id="analytics">Analytics</h2>
            <h3>Event Type Distribution</h3>
            <canvas id="eventTypeChart" width="400" height="200"></canvas>

            <h3>Communication Trends Over Time</h3>
            <canvas id="trendChart" width="400" height="200"></canvas>

            <h3>Medium Usage</h3>
            <canvas id="mediumChart" width="400" height="200"></canvas>
        </main>
    </div>

    <script>
        document.getElementById('communication-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            try {
                const response = await fetch('/submit', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    alert('Data submitted successfully!');
                    fetchAnalytics();
                } else {
                    const error = await response.json();
                    alert('Error: ' + error.error);
                }
            } catch (err) {
                console.error(err);
                alert('Failed to submit data.');
            }
        });

        async function fetchAnalytics() {
            // Event Type Chart
            const eventTypeResponse = await fetch('/analytics/event_type');
            const eventTypeData = await eventTypeResponse.json();
        
            const eventLabels = eventTypeData.map(item => item[0]); // Extract categories
            const eventCounts = eventTypeData.map(item => item[1]); // Extract counts
        
            Plotly.newPlot('eventTypeChart', [{
                labels: eventLabels,
                values: eventCounts,
                type: 'pie',
                textinfo: 'label+percent',
                insidetextorientation: 'radial'
            }], {
                title: 'Event Type Distribution'
            });
        
            // Trend Chart
            const trendResponse = await fetch('/analytics/trend');
            const trendData = await trendResponse.json();
        
            // Extract and format dates and counts
            const trendLabels = trendData.map(item => new Date(item[0]).toISOString().split('T')[0]); // Format to YYYY-MM-DD
            const trendCounts = trendData.map(item => item[1]);
        
            Plotly.newPlot('trendChart', [{
                x: trendLabels,
                y: trendCounts,
                type: 'scatter',
                mode: 'lines+markers',
                line: { color: 'blue' }
            }], {
                title: 'Communication Trends Over Time',
                xaxis: { title: 'Date' },
                yaxis: { title: 'Number of Communications' }
            });
        
            // Medium Usage Chart
            const mediumResponse = await fetch('/analytics/medium');
            const mediumData = await mediumResponse.json();
        
            const mediumLabels = mediumData.map(item => item[0]); // Extract Medium names
            const mediumCounts = mediumData.map(item => item[1]); // Extract counts
        
            Plotly.newPlot('mediumChart', [{
                x: mediumLabels,
                y: mediumCounts,
                type: 'bar',
                marker: { color: 'orange' }
            }], {
                title: 'Medium Usage',
                xaxis: { title: 'Medium' },
                yaxis: { title: 'Count' }
            });
        }
        
        // Fetch analytics on page load
        fetchAnalytics();
    </script>
</body>
</html>
